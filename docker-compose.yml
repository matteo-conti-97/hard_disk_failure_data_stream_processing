# profile all builds all services, profile processing builds all services except Nifi, ingestion buils only HDFS and Nifi services
services:  
  nifi:
    image: apache/nifi:latest
    container_name: nifi
    environment:
      - SINGLE_USER_CREDENTIALS_USERNAME=admin
      - SINGLE_USER_CREDENTIALS_PASSWORD=123456789101112
      - NIFI_JVM_HEAP_MAX=2g
    volumes:
      - nifi-data:/opt/nifi/nifi-current/Data
    ports:
      - 8443:8443
      - 5200:5200
    networks:
      - elt_cluster
    profiles: [ingestion, all]

  jobmanager:
    image: flink:latest
    ports:
      - "8081:8081"
    command: jobmanager
    environment:
      - |
        FLINK_PROPERTIES=
        jobmanager.rpc.address: jobmanager    
    volumes:
      - job-manager-data:/opt/flink/flink-current/data
    networks:
      - elt_cluster
    profiles: [all]    

  taskmanager:
    image: flink:latest
    depends_on:
      - jobmanager
    command: taskmanager
    scale: 1
    environment:
      - |
        FLINK_PROPERTIES=
        jobmanager.rpc.address: jobmanager
        taskmanager.numberOfTaskSlots: 2
    volumes:
      - task-manager-data:/opt/flink/flink-current/data
    networks:
      - elt_cluster
    profiles: [all]   
      
volumes:
  nifi-data:
  job-manager-data:
  task-manager-data:

networks:
  elt_cluster:
    driver: bridge
  
